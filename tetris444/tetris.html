<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tetris Neon Deluxe</title>
<style>
  :root {
    --cell: 28px;
    --cols: 10;
    --rows: 20;
    --neon-blue: #00eaff;
    --neon-pink: #ff00c8;
    --bg1: #06071a;
    --bg2: #0a1535;
  }

  html, body {
    height: 100%;
    margin: 0;
    font-family: "Orbitron", "Inter", sans-serif;
    background: radial-gradient(circle at top, var(--bg2), var(--bg1));
    color: #e8f6ff;
    overflow: hidden;
  }

  .wrap { height: 100%; display: flex; align-items: center; justify-content: center; padding: 28px; }
  .board { display: grid; grid-template-columns: 1fr 260px; gap: 24px; align-items: start; }

  h1 {
    font-size: 22px;
    margin: 0;
    background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px var(--neon-blue);
    letter-spacing: 1px;
  }

  .game {
    background: rgba(10, 20, 40, 0.8);
    padding: 16px;
    border-radius: 16px;
    box-shadow: 0 0 25px rgba(0, 238, 255, 0.2), inset 0 0 20px rgba(0, 238, 255, 0.08);
    position: relative;
    backdrop-filter: blur(10px);
  }

  canvas#tetris {
    border: 3px solid var(--neon-blue);
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 238, 255, 0.5), inset 0 0 10px rgba(0, 238, 255, 0.3);
    display: block;
    background: radial-gradient(circle at top, #051425, #000);
  }

  .overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    background: rgba(0, 0, 0, 0.5);
  }

  .overlay .box {
    background: rgba(5, 10, 20, 0.9);
    padding: 20px 26px;
    border-radius: 12px;
    border: 2px solid var(--neon-blue);
    box-shadow: 0 0 20px rgba(0, 238, 255, 0.4);
    text-align: center;
    animation: pop 0.3s ease;
  }

  @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .side { width: 260px; }

  .panel {
    background: linear-gradient(180deg, rgba(5,15,35,0.8), rgba(3,10,25,0.8));
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 14px;
    box-shadow: 0 0 12px rgba(0, 180, 255, 0.2);
  }

  .panel .small { font-size: 13px; color: #9fdfff; }

  .next-canvas {
    background: #041024;
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,0.08);
    margin-top: 6px;
    display: block;
  }

  .controls { display: flex; gap: 6px; flex-wrap: wrap; }

  button {
    background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
    border: none;
    color: white;
    padding: 8px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-family: inherit;
    transition: 0.2s;
    box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
  }

  button:hover { filter: brightness(1.3); box-shadow: 0 0 18px rgba(255, 0, 255, 0.5); }

  footer { font-size: 11px; text-align: center; color: #a0cfff; opacity: 0.8; }
  footer strong { color: #fff; }

  .hint { font-size: 12px; color: #88b8ff; margin-top: 4px; }

  #timer {
    font-size: 18px;
    color: #00ffff;
    text-shadow: 0 0 8px #00ffff;
    text-align: center;
    margin-top: 5px;
  }
</style>
</head>
<body tabindex="0">
<div class="wrap">
  <div class="board">
    <div class="game">
      <h1>üß© Tetris Neon Deluxe</h1>
      <div id="timer">Waktu: 60</div>
      <canvas id="tetris" width="280" height="560"></canvas>

      <div id="overlay" class="overlay" style="display:none">
        <div class="box">
          <h2 id="overlay-title">Game Over</h2>
          <p id="overlay-msg">Waktu habis!</p>
          <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
            <button id="overlay-restart">Restart</button>
            <button id="overlay-close">Tutup</button>
          </div>
        </div>
      </div>
      <div class="hint">Gunakan: ‚Üê ‚Üí untuk gerak | ‚Üë rotasi | ‚Üì jatuh | Spasi cepat</div>
    </div>

    <div class="side">
      <div class="panel">
        <div style="display:flex;justify-content:space-between">
          <div><div class="small">Skor</div><div id="score">0</div></div>
          <div><div class="small">Level</div><div id="level">1</div></div>
          <div><div class="small">Baris</div><div id="lines">0</div></div>
        </div>
        <div class="small" style="margin-top:6px">Highscore: <span id="highscore">0</span></div>
      </div>

      <div class="panel">
        <div class="small">Next</div>
        <canvas id="next" class="next-canvas" width="112" height="112"></canvas>
      </div>

      <div class="panel controls">
        <button id="btn-left">‚Üê</button>
        <button id="btn-rotate">‚Üë</button>
        <button id="btn-right">‚Üí</button>
        <button id="btn-down">‚Üì</button>
        <button id="btn-drop">‚è¨</button>
      </div>

      <div class="panel">
        <button id="btn-pause">Pause</button>
        <button id="btn-restart">Restart</button>
      </div>

      <footer>
        <div>Made with üíñ by <strong>Ekskul Coding SMAN 2 Pangkalan Bun</strong></div>
        <div><small>Dimentori oleh <strong>ahliweb.com</strong></small></div>
      </footer>
    </div>
  </div>
</div>

<script>
// === GAME LOGIC === //
const GAME_TIME_LIMIT = 60;
let timeLeft = GAME_TIME_LIMIT;
let timerInterval = null;

const bgMusic = new Audio("https://cdn.pixabay.com/download/audio/2023/02/28/audio_c59488a87c.mp3?filename=arcade-funk-139190.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.3;
const beep = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_09e4c1f2f8.mp3?filename=beep-warning-6387.mp3");
const gameOverSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8a6aeecc3.mp3?filename=negative_beeps-6008.mp3");

const canvas = document.getElementById("tetris");
const ctx = canvas.getContext("2d");
const nextCanvas = document.getElementById("next");
const nctx = nextCanvas.getContext("2d");

const scale = 28, COLS = 10, ROWS = 20;
const colors = [null, "#00f0f0","#0050f0","#f0a000","#f0f000","#00f000","#a000f0","#f04040"];
const shapes = {
  I: [[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
  O: [[2,2],[2,2]],
  T: [[0,3,0],[3,3,3],[0,0,0]],
  S: [[0,4,4],[4,4,0],[0,0,0]],
  Z: [[5,5,0],[0,5,5],[0,0,0]],
  J: [[6,0,0],[6,6,6],[0,0,0]],
  L: [[0,0,7],[7,7,7],[0,0,0]],
};
const pieces = "IOTSZJL";

function createMatrix(w,h){const m=[];while(h--)m.push(new Array(w).fill(0));return m;}
let arena = createMatrix(COLS,ROWS);
const player={pos:{x:0,y:0},matrix:null};
let nextPiece={matrix:createPiece(randomPiece())};

function randomPiece(){return pieces[Math.floor(Math.random()*pieces.length)];}
function createPiece(t){return shapes[t].map(r=>r.slice());}

function drawMatrix(matrix,offset,context,size){
  for(let y=0;y<matrix.length;y++){
    for(let x=0;x<matrix[y].length;x++){
      if(matrix[y][x]){
        context.fillStyle=colors[matrix[y][x]];
        context.fillRect((x+offset.x)*size,(y+offset.y)*size,size-1,size-1);
      }
    }
  }
}

function collide(arena,piece){
  for(let y=0;y<piece.matrix.length;y++){
    for(let x=0;x<piece.matrix[y].length;x++){
      if(piece.matrix[y][x]&&(arena[y+piece.pos.y]&&arena[y+piece.pos.y][x+piece.pos.x])!==0)return true;
    }
  }return false;
}

function merge(arena,piece){
  piece.matrix.forEach((row,y)=>{
    row.forEach((value,x)=>{
      if(value)arena[y+piece.pos.y][x+piece.pos.x]=value;
    });
  });
}

function rotate(matrix,dir){
  for(let y=0;y<matrix.length;y++){for(let x=0;x<y;x++){[matrix[x][y],matrix[y][x]]=[matrix[y][x],matrix[x][y]];}}
  if(dir>0)matrix.forEach(r=>r.reverse());else matrix.reverse();
}

function spawnNext(){
  player.matrix=nextPiece.matrix;
  player.pos.y=0;
  player.pos.x=Math.floor((COLS-player.matrix[0].length)/2);
  nextPiece.matrix=createPiece(randomPiece());
  if(collide(arena,player)){stopGame();showOverlay("Game Over","Area penuh ‚Äî permainan selesai.");gameOverSound.play();}
}

let score=0,lines=0,level=1,highscore=0;
const STORAGE_KEY="tetris_highscore";
function loadHigh(){highscore=parseInt(localStorage.getItem(STORAGE_KEY)||"0");document.getElementById("highscore").innerText=highscore;}
function saveHigh(){localStorage.setItem(STORAGE_KEY,highscore);}
function updateStats(){document.getElementById("score").innerText=score;document.getElementById("level").innerText=level;document.getElementById("lines").innerText=lines;if(score>highscore){highscore=score;saveHigh();}}

let dropCounter=0,lastTime=0,dropInterval=1000,running=false,paused=false;
function update(t=0){
  if(!running)return;
  const delta=t-lastTime;lastTime=t;
  if(!paused){dropCounter+=delta;if(dropCounter>dropInterval){player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);clearLines();spawnNext();}dropCounter=0;}}
  draw();requestAnimationFrame(update);
}

function clearLines(){
  outer:for(let y=arena.length-1;y>=0;y--){
    for(let x=0;x<arena[y].length;x++){if(arena[y][x]===0)continue outer;}
    const row=arena.splice(y,1)[0].fill(0);arena.unshift(row);y++;
    score+=100;lines++;level=Math.floor(lines/10)+1;
  }
  updateStats();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMatrix(arena,{x:0,y:0},ctx,scale);
  drawMatrix(player.matrix,player.pos,ctx,scale);
  nctx.clearRect(0,0,nextCanvas.width,nextCanvas.height);
  drawMatrix(nextPiece.matrix,{x:1,y:1},nctx,28);
}

function showOverlay(t,m){document.getElementById("overlay-title").innerText=t;document.getElementById("overlay-msg").innerText=m;document.getElementById("overlay").style.display="flex";}
function hideOverlay(){document.getElementById("overlay").style.display="none";}

function startTimer(){
  clearInterval(timerInterval);
  timeLeft=GAME_TIME_LIMIT;
  document.getElementById("timer").innerText=`Waktu: ${timeLeft}`;
  timerInterval=setInterval(()=>{
    if(!paused){
      timeLeft--;
      document.getElementById("timer").innerText=`Waktu: ${timeLeft}`;
      if(timeLeft===10)beep.play();
      if(timeLeft<=0){stopGame();gameOverSound.play();showOverlay("Waktu Habis!","Permainan selesai.");}
    }
  },1000);
}

function startGame(){
  arena=createMatrix(COLS,ROWS);
  score=0;lines=0;level=1;
  loadHigh();hideOverlay();
  spawnNext();updateStats();startTimer();
  running=true;bgMusic.play();requestAnimationFrame(update);
}
function stopGame(){running=false;clearInterval(timerInterval);bgMusic.pause();}

// === Kontrol ===
document.addEventListener("keydown",e=>{
  if(!running)return;
  if(e.key==="ArrowLeft"){player.pos.x--;if(collide(arena,player))player.pos.x++;}
  else if(e.key==="ArrowRight"){player.pos.x++;if(collide(arena,player))player.pos.x--;}
  else if(e.key==="ArrowDown"){player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);clearLines();spawnNext();}}
  else if(e.key==="ArrowUp"){rotate(player.matrix,1);if(collide(arena,player))rotate(player.matrix,-1);}
  else if(e.code==="Space"){while(!collide(arena,player))player.pos.y++;player.pos.y--;merge(arena,player);clearLines();spawnNext();}
  else if(e.key.toLowerCase()==="p"){paused=!paused;document.getElementById("btn-pause").innerText=paused?"Resume":"Pause";paused?bgMusic.pause():bgMusic.play();}
});

// Tombol UI
document.getElementById("btn-left").onclick=()=>{player.pos.x--;if(collide(arena,player))player.pos.x++;};
document.getElementById("btn-right").onclick=()=>{player.pos.x++;if(collide(arena,player))player.pos.x--;};
document.getElementById("btn-rotate").onclick=()=>{rotate(player.matrix,1);if(collide(arena,player))rotate(player.matrix,-1);};
document.getElementById("btn-down").onclick=()=>{player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);clearLines();spawnNext();}};
document.getElementById("btn-drop").onclick=()=>{while(!collide(arena,player))player.pos.y++;player.pos.y--;merge(arena,player);clearLines();spawnNext();};
document.getElementById("btn-pause").onclick=()=>{paused=!paused;document.getElementById("btn-pause").innerText=paused?"Resume":"Pause";paused?bgMusic.pause():bgMusic.play();};
document.getElementById("btn-restart").onclick=()=>startGame();
document.getElementById("overlay-restart").onclick=()=>{hideOverlay();startGame();};
document.getElementById("overlay-close").onclick=()=>hideOverlay();

// üî• Auto start saat halaman dibuka
window.onload=startGame;
</script>
</body>
</html>
